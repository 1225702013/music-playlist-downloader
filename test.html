<!DOCTYPE html>
<html>
<head>
    <title>Test XMLHttpRequest download with progress bar</title>
    <script type="text/javascript" src="/js/jquery-2.2.0.js"></script>
</head>
<body>
    <div style="width:600px;margin:10px auto;background-color:#fff;">
        <input id="DownLoadFile" type="button" value="DownLoadFile" />
        <div style="height:8px;width:100px;border-radius:3px;border:1px solid #eee;">
            <div id="progressBar" style="background-color:#ccf;height:6px;width:0px;border-radius:3px;border:0px;"></div>
        </div>
    </div>
  </body>
</html>
<script type="text/javascript">
    var onProgress = function (e) {
        if (e.lengthComputable) {
            document.getElementById("progressBar").style.width = Math.round(e.loaded * 100 / e.total) + 'px';
        }
    };
    $(function () {
        $('#DownLoadFile').on('click', function () {
            var xhr = new XMLHttpRequest();
            xhr.onprogress = onProgress; //下载监听
            xhr.responseType = "blob";
            xhr.open("GET", "http://localhost:36348/Doc/TortoiseSVN-1.9.4.27285-x64.zip", true);
            xhr.onreadystatechange = function (e) {
                if (this.readyState == 4 && this.status == 200) {
                    var response = this.response;
                    var URL = window.URL || window.webkitURL || window;
                    var link = document.createElement('a');
                    link.href = URL.createObjectURL(response);
                    link.download = 'TestDownLoad';
                    //link.click(); //ie及firefox不响应识别模拟点击事件
                    //下面方法,edge,chrome和firefox都兼容
                    var event = document.createEvent('MouseEvents');
                    event.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
                    link.dispatchEvent(event);
                }
            }
            xhr.send(null);
            return false;
        });
    });
</script>